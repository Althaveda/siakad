/*SIAKAD UNCP Js Config*/
/*==========================================*/
/*Dev		=> Muhammad Dicky Hidayat Latif*/
/*Email		=> muh.dickyhidayat@gmail.com*/
/*==========================================*/

function daftar_kelas_mhs(a){$("#box-kelas-mhs").fadeIn(),collapse_box("#box-kelas-mhs"),$("#box-kelas-mhs").find("div.overlay").fadeIn(),$(".tbl-daftar-kelas-mhs").find("tbody").html('<tr><td colspan="5" align="center" class="load-data">Memproses Data</td></tr>'),getJSON_async("http://"+host+path_home+"/action/ambil",{kelas:a,data:"daftar_kelas_mhs"},500).then(function(a){if(""!=a.record_kelas){$("#box-kelas-mhs").find("div.overlay").fadeOut(),$("html, body").animate({scrollTop:$("#box-kelas-mhs").offset().top-55},800);var t;if($.each(a.record_kelas,function(a,l){$.each(l,function(a,t){null!=t&&""!=t||(t="-"),$(".detail-kelas .detail-kelas-"+a).text(t)}),0!=l.jenis_jdl&&$(".detail-kelas .detail-kelas-nama_mk").text(l.nama_mk+" (Konsentrasi "+l.nm_konsentrasi+")"),t=l.status_jdl}),""!=a.record_mhs){$(".tbl-daftar-kelas-mhs").find("tbody").text("");var l=1;$.each(a.record_mhs,function(a,t){if("L"==t.jk)e="Laki-Laki";else var e="Perempuan";$("table.tbl-daftar-kelas-mhs").find("tbody").append('<tr>  <td class="text-center">'+l+'</td>  <td class="text-center">'+t.nisn+"</td>  <td>"+t.nama+'</td>  <td class="text-center">'+e+'</td>  <td class="text-center">'+t.tahun_angkatan+"</td></tr>"),l++})}else $(".tbl-daftar-kelas-mhs").find("tbody").html('<tr><td colspan="5" align="center">Untuk sekarang kelas ini belum memiliki mahasiswa</td></tr>')}else swal({title:"Info",text:"Kelas yang anda pilih tidak terdaftar dalam database!",type:"info",timer:2e3});$(".view-kelas").find("i").removeClass("fa-circle-o-notch fa-spin").addClass("fa-list"),$(".check-status-mhs-kls").bootstrapToggle({on:'<i class="fa fa-check-circle"></i> Aktif',off:'<i class="fa fa-ban"></i> Tidak Aktif',size:"small",onstyle:"success",offstyle:"danger",width:100})}).catch(function(a){$(".view-kelas").find("i").removeClass("fa-circle-o-notch fa-spin").addClass("fa-list")})}function detail_nilai(a){$("#box-nilai div.overlay").fadeIn(),$(".tbl-nilai-mhs").find("tbody").html('<tr class="table-load"><td class="text-center load-data" colspan="7">Memproses Data</td></tr>'),getJSON_async("http://"+host+controller_path+"/action/ambil",{thn:a,data:"daftar_nilai_mhs"},500).then(function(a){if(""!=a.record_nilai){$(".tbl-nilai-mhs").find("tbody").text(""),$(".tahun-ajaran-ket").text(a.thn);var t=1;$.each(a.record_nilai,function(a,l){$(".tbl-nilai-mhs").find("tbody").append('<tr>  <td class="text-center">'+t+'</td>  <td class="text-center">'+l.kode_mk+"</td>  <td>"+l.nama_mk+'</td>  <td class="text-center">'+l.jml_sks+'</td>  <td class="text-center">'+l.hm+'</td>  <td class="text-center">'+l.am+'</td>  <td class="text-center">'+l.mutu+"</td></tr>"),t++}),$(".tbl-nilai-mhs").find("tbody").append('<tr>  <td colspan="3" class="text-right">Jumlah SKS</td>  <td class="text-center">'+a.sks+'</td>  <td colspan="2"></td>  <td class="text-center">'+a.mutu+"</td></tr>")}else"-"==a.thn?$(".tbl-nilai-mhs").find("tbody").html('<tr><td class="text-center" colspan="7">Silahkan pilih tahun akademik</td></tr>'):swal({title:"Info",text:"Tahun akademik yang anda pilih tidak terdaftar dalam database!",type:"info",timer:2e3});$("#box-nilai").find("div.overlay").fadeOut(),$(".tamp-nilai").find("i").removeClass("fa-circle-o-notch fa-spin").addClass("fa-file-text-o")}).catch(function(a){$(".tamp-nilai").find("i").removeClass("fa-circle-o-notch fa-spin").addClass("fa-file-text-o"),$("#box-nilai").find("div.overlay").fadeOut(),1==$(".tbl-nilai-mhs tr.table-load").length&&$(".tbl-nilai-mhs tr.table-load td").html("Terjadi kesalahan, <b>Error "+a.status+": "+a.statusText+"</b>"),setTimeout(function(){$(".tbl-nilai-mhs tr.table-load").remove()},2e3)})}function daftar_jadwal_mhs(a,t,l){if($("#box-jadwal div.overlay").fadeIn(),collapse_box("#box-jadwal, #box-jadwal .box"),$("#box-jadwal").find("div.overlay").fadeIn(),null!=t||null==a){e=9;$("#box-kelas-mhs").slideUp()}else var e=6;$("table.tbl-data-jadwal tbody tr").length>0?$("table.tbl-data-jadwal").find("tbody").prepend('<tr class="table-load"><td class="text-center load-data" colspan="'+e+'">Memproses Data</td></tr>'):$("table.tbl-data-jadwal").find("tbody").html('<tr class="table-load"><td class="text-center load-data" colspan="'+e+'">Memproses Data</td></tr>'),getJSON_async("http://"+host+path_home+"/action/ambil",{data:"daftar_jadwal_mhs",d:a,thn:t,all:l},500).then(function(t){1==a&&$("#box-jadwal .box-title").html('<li class="fa fa-list"></li> Jadwal Kuliah Hari '+t.hari_i),""!=t.record_jadwal?($("table.tbl-data-jadwal").find("tbody").text(""),$("#box-jadwal .tahun-ajaran-jad").html('<li class="fa fa-book"></li> '+t.record_jadwal[0].thn_ajaran),$("#box-jadwal .jumlah-jadwal-jad").html('<li class="fa fa-list"></li> '+t.count_jadwal_ptk.count_ptk_jdl),$("#box-jadwal .jumlah-kls-jad").html('<li class="fa fa-building-o"></li> '+t.count_jadwal_ptk.count_ptk_kls),$.each(t.record_u,function(l,e){var s,d,i,n=1,r=1,o=1;$.each(t.record_kelas,function(l,c){if(1==o&&0==c.jenis_jdl||o==r&&0==c.jenis_jdl){m=' style="background-color:#f9f9f9;"';r++,r++}else var m="";e.jenis_jdl==c.jenis_jdl&&0==e.jenis_jdl?(s=c.semester+"/"+c.kelas,n=1,$.each(t.record_jadwal,function(t,l){if(null!=l.nama_mk&&""!=l.nama_mk||(l.nama_mk="-",l.jml_sks="-"),null!=l.nama_ptk&&""!=l.nama_ptk||(l.nama_ptk="-"),(d=l.semester+"/"+l.kelas)==s&&l.jenis_jdl==e.jenis_jdl){if(1!=a)var r='  <td class="text-center">'+l.hari_jdl+"</td>",o='  <td class="text-center"><li class="fa fa-users" title="Jumlah mahasiswa kelas '+l.semester+"/"+l.kelas+'"></li> '+l.jml_mhs+' <li class="fa fa-male" title="Jumlah mahasiswa laki-laki kelas '+l.semester+"/"+l.kelas+'"></li> '+l.jml_lk+' <li class="fa fa-female" title="Jumlah mahasiswa perempuan kelas '+l.semester+"/"+l.kelas+'"></li> '+l.jml_pr+'</td>  <td class="text-center"><button class="btn btn-warning btn-sm view-kelas" value="'+l.jdl_in+'" title="Lihat daftar mahasiswa kelas '+l.semester+"/"+l.kelas+" mata kuliah "+l.nama_mk+'"><i class="fa fa-list"></i></button></td>';1==n?($("table.tbl-data-jadwal").find("tbody").append("<tr"+m+'>  <td rowspan="" class="kelas-row'+l.jdl_no+' text-center">'+l.semester+"/"+l.kelas+"</td>"+r+'  <td class="text-center">'+l.jam_mulai_jdl+" - "+l.jam_akhir_jdl+"</td>  <td>"+l.nama_mk+'</td>  <td class="text-center">'+l.jml_sks+'</td>  <td class="text-center">'+l.ruang+"</td>  <td>"+l.nama_ptk+"</td>"+o+"</tr>"),i=l.jdl_no):$("table.tbl-data-jadwal").find("tbody").append("<tr"+m+">"+r+'  <td class="text-center">'+l.jam_mulai_jdl+" - "+l.jam_akhir_jdl+"</td>  <td>"+l.nama_mk+'</td>  <td class="text-center">'+l.jml_sks+'</td>  <td class="text-center">'+l.ruang+"</td>  <td>"+l.nama_ptk+"</td>"+o+"</tr>"),n++}}),$("table.tbl-data-jadwal .kelas-row"+i).attr("rowspan",n-1),o++):0!=e.jenis_jdl&&(s=c.semester+"/"+c.kelas,$.each(t.record_jadwal,function(t,l){if(null!=l.nama_mk&&""!=l.nama_mk||(l.nama_mk="-",l.jml_sks="-"),(d=l.semester+"/"+l.kelas)==s&&l.jenis_jdl==e.jenis_jdl){if(1!=a)var i="9",r='  <td class="text-center">'+l.hari_jdl+"</td>",o='  <td class="text-center"><li class="fa fa-users" title="Jumlah mahasiswa kelas '+l.semester+"/"+l.kelas+'"></li> '+l.jml_mhs+' <li class="fa fa-male" title="Jumlah mahasiswa laki-laki kelas '+l.semester+"/"+l.kelas+'"></li> '+l.jml_lk+' <li class="fa fa-female" title="Jumlah mahasiswa perempuan kelas '+l.semester+"/"+l.kelas+'"></li> '+l.jml_pr+'</td>  <td class="text-center"><button class="btn btn-warning btn-sm view-kelas" value="'+l.jdl_in+'" title="Lihat daftar mahasiswa kelas '+l.semester+"/"+l.kelas+" mata kuliah "+l.nama_mk+'"><i class="fa fa-list"></i></button></td>';else i="6";1==n?$("table.tbl-data-jadwal").find("tbody").append('<tr>  <td colspan="'+i+'" align="left"><b>Konsentrasi '+l.nm_konsentrasi+'</b></td></tr><tr>  <td rowspan="" class="text-center">'+l.semester+"/"+l.kelas+"</td>"+r+'  <td class="text-center">'+l.jam_mulai_jdl+" - "+l.jam_akhir_jdl+"</td>  <td>"+l.nama_mk+'</td>  <td class="text-center">'+l.jml_sks+'</td>  <td class="text-center">'+l.ruang+"</td>  <td>"+l.nama_ptk+"</td>"+o+"</tr>"):$("table.tbl-data-jadwal").find("tbody").append('<tr>  <td rowspan="" class="text-center">'+l.semester+"/"+l.kelas+"</td>"+r+'  <td class="text-center">'+l.jam_mulai_jdl+" - "+l.jam_akhir_jdl+"</td>  <td>"+l.nama_mk+'</td>  <td class="text-center">'+l.jml_sks+'</td>  <td class="text-center">'+l.ruang+"</td>  <td>"+l.nama_ptk+"</td>"+o+"</tr>"),n++}}))})})):"-"!=t.c_thn_ajaran?1==a?$("table.tbl-data-jadwal tbody").html('<tr><td colspan="6" align="center">Untuk hari ini anda tidak memiliki jadwal kuliah</td></tr>'):$("table.tbl-data-jadwal tbody").html('<tr><td colspan="9" align="center">Untuk tahun akademik ini anda tidak memiliki jadwal kuliah</td></tr>'):1==a?$("table.tbl-data-jadwal tbody").html('<tr><td colspan="6" align="center">Untuk saat ini tidak ada tahun akademik yang diterapkan</td></tr>'):$("table.tbl-data-jadwal tbody").html('<tr><td colspan="9" align="center">Untuk saat ini tidak ada tahun akademik yang diterapkan</td></tr>'),$(".tamp-jadwal, .tamp-all-jadwal").find("i").removeClass("fa-circle-o-notch fa-spin").addClass("fa-list"),$("#box-jadwal").find("div.overlay").fadeOut()}).catch(function(a){$("#box-jadwal").find("div.overlay").fadeOut(),$(".tamp-jadwal, .tamp-all-jadwal").find("i").removeClass("fa-circle-o-notch fa-spin").addClass("fa-list"),1==$("table.tbl-data-jadwal tbody tr.table-load").length&&$("table.tbl-data-jadwal tbody tr.table-load td").html("Terjadi kesalahan, <b>Error "+a.status+": "+a.statusText+"</b>"),setTimeout(function(){$("table.tbl-data-jadwal tbody tr.table-load").remove()},2e3)})}function detail_akademik_mhs(){0==$(".tbl-riwayat-studi-mhs tr.table-load").length&&$(".tbl-riwayat-studi-mhs").find("tbody").append('<tr class="table-load"><td class="text-center load-data" colspan="5">Memproses Data</td></tr>'),0==$(".tbl-riwayat-kuliah-mhs tr.table-load").length&&$(".tbl-riwayat-kuliah-mhs").find("tbody").append('<tr class="table-load"><td class="text-center load-data" colspan="4">Memproses Data</td></tr>'),getJSON_async("http://"+host+controller_path+"/action/ambil",{data:"riwayat_akademik_mhs"},1e3).then(function(a){if(""!=a.record_akademik){$(".tbl-riwayat-studi-mhs, .tbl-riwayat-kuliah-mhs").find("tbody").text(""),$(".box-profile .profil-rwt-studi").text(a.record_akademik.length);var t,l=1,e=1;$.each(a.record_akademik,function(a,s){if($(".tbl-riwayat-studi-mhs").find("tbody").append('<tr>  <td class="text-center">'+l+'</td>  <td class="text-center">'+s.thn_ajaran_jdl+'</td>  <td class="text-center">'+s.kode_mk+"</td>  <td>"+s.nama_mk+'</td>  <td class="text-center">'+s.jml_sks+"</td></tr>"),l++,"Aktif"==s.status_aktif_mhs&&s.statik_aktif_mhs>=50)d='<button type="button" class="btn btn-success btn-sm" style="width:100px;pointer-events:none;cursor:default">  <b><i class="fa fa-check-circle"></i> Aktif</b></button>';else var d='<button type="button" class="btn btn-danger btn-sm" style="width:100px;pointer-events:none;cursor:default">  <b><i class="fa fa-times"></i> Tidak Aktif</b></button>';s.thn_ajaran_jdl!=t&&($(".box-profile .profil-rwt-akademik").text(e),$(".tbl-riwayat-kuliah-mhs").find("tbody").append('<tr>  <td class="text-center">'+e+'</td>  <td class="text-center">'+s.thn_ajaran_jdl+'</td>  <td class="text-center">'+d+'</td>  <td class="text-center">'+s.total_sks+"</td></tr>"),e++,t=s.thn_ajaran_jdl)})}else $(".tbl-riwayat-kuliah-mhs").find("tbody").html('<tr>  <td colspan="4" align="center">Untuk saat ini, mahasiswa ini belum memiliki riwayat kuliah</td></tr>'),$(".tbl-riwayat-studi-mhs").find("tbody").html('<tr>  <td colspan="5" align="center">Untuk saat ini, mahasiswa ini belum memiliki riwayat studi</td></tr>')}).catch(function(a){1==$(".tbl-riwayat-studi-mhs tr.table-load").length&&$(".tbl-riwayat-studi-mhs tr.table-load td").html("Terjadi kesalahan, <b>Error "+a.status+": "+a.statusText+"</b>"),1==$(".tbl-riwayat-kuliah-mhs tr.table-load").length&&$(".tbl-riwayat-kuliah-mhs tr.table-load td").html("Terjadi kesalahan, <b>Error "+a.status+": "+a.statusText+"</b>"),setTimeout(function(){$(".tbl-riwayat-studi-mhs tr.table-load, .tbl-riwayat-kuliah-mhs tr.table-load").remove()},2e3)})}var path=window.location.pathname,host=window.location.hostname,delay=function(){var a=0;return function(t,l){clearTimeout(a),a=setTimeout(t,l)}}();if(path==beranda_mhs_path+"/data_mhs"||path==beranda_mhs_path+"/data_jadwal"||path==beranda_mhs_path+"/nilai_mhs")var controller_path=beranda_mhs_path;else if(path==beranda_ptk_path+"/data_tenaga_pendidik"||path==beranda_ptk_path+"/jadwal_mengajar"||path==beranda_ptk_path+"/nilai_mhs")var controller_path=beranda_ptk_path;$(function(){path==controller_path+"/data_mhs"&&($("#box-siswa div.overlay").fadeOut(),getJSON_async("http://"+host+controller_path+"/action/ambil",{data:"data_mhs"},500).then(function(a){""!=a.record_mhs?(detail_akademik_mhs(),$.each(a.record_mhs,function(a,t){$.each(t,function(a,t){""!=t&&"0"!=t||(t="-"),"jk"==a&&"L"==t?t="Laki - Laki":"jk"==a&&"P"==t&&(t="Perempuan"),$(".box-profile .profil-"+a).text(t),$("#detail-"+a).text(t)}),null!=t.tgl_lulus&&null==t.tgl_drop_out?($(".box-profile li.tgl-mhs").find("b").text("Tanggal Kelulusan"),$(".box-profile li.tgl-mhs").find("p").text(t.tgl_lulus)):null==t.tgl_lulus&&null!=t.tgl_drop_out?($(".box-profile li.tgl-mhs").find("b").text("Tanggal Drop Out"),$(".box-profile li.tgl-mhs").find("p").text(t.tgl_drop_out)):($(".box-profile li.tgl-mhs").find("b").text("Tanggal Masuk"),$(".box-profile li.tgl-mhs").find("p").text(t.tgl_masuk_angkatan))})):$("#detail-mhs dl dd").text("-")})),path==controller_path+"/data_jadwal"&&daftar_jadwal_mhs(),path==controller_path+"/nilai_mhs"&&($("#box-content div.overlay, #box-nilai div.overlay").fadeOut(),detail_nilai()),$("#box-jadwal .refresh-data-mhs").on("click",function(){var a=$(this).find("i");a.addClass("fa-spin"),setTimeout(function(){a.removeClass("fa-spin")},1050),daftar_jadwal_mhs(!0)}),$(".tamp-jadwal").on("click",function(a){a.preventDefault(),$(this).find("i").removeClass("fa-list").addClass("fa-circle-o-notch fa-spin"),daftar_jadwal_mhs(!1,$(".select2_jadwal").val())}),$(".tamp-all-jadwal").on("click",function(a){a.preventDefault(),$(this).find("i").removeClass("fa-list").addClass("fa-circle-o-notch fa-spin"),daftar_jadwal_mhs(!1,$(".select2_jadwal").val(),!0)}),$(document).on("click",".view-kelas",function(){$(this).find("i").removeClass("fa-list").addClass("fa-circle-o-notch fa-spin"),daftar_kelas_mhs($(this).val())}),$(document).on("click",".remove-kelas",function(){delay(function(){$(".detail-kelas .detail-kelas-mhs").text("-"),$(".tbl-daftar-kelas-mhs").find("tbody").html('<tr><td colspan="5" align="center">Silahkan pilih kelas</td></tr>')},1e3)}),$(".tamp-nilai").on("click",function(a){a.preventDefault();var t=$(".select2_jadwal").val();$(this).find("i").removeClass("fa-file-text-o").addClass("fa-circle-o-notch fa-spin"),detail_nilai(t)}),$('a[href="#detail_riwayat_kuliah"], a[href="#detail_riwayat_studi"]').on("click",function(){delay(function(){detail_akademik_mhs()},100)}),$(document).on("click","#submit",function(a){a.preventDefault(),$("#form-input").find(".has-error").removeClass("has-error");var t=$("#form-input").attr("action"),l=$("#form-input").serialize();$("#alert-place").text("");$("#form-input input[name=data]").val(),getUrlVars();$.ajax("http://"+host+controller_path+"/action/"+t,{dataType:"json",type:"POST",data:l,success:function(a){if("tambah"==t)if("success"==a.status)swal({title:"Data Berhasil Disimpan",type:"success",timer:1e3});else if("failed"==a.status){var l="";$.each(a.errors,function(a,t){l+='<li class="text-center">'+t+"</li>"}),swal({title:"Gagal!",type:"error",html:l})}else swal({title:"Terjadi Error",type:"error"})},error:function(){swal({title:"Error",text:"Maaf, telah terjadi error pada server!",type:"error",timer:2e3})}})})});